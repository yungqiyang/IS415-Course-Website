<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Yung Qi Yang">
<meta name="dcterms.date" content="2024-02-06">

<title>IS415 Course Website - Take-Home Exercise 1: Application of Spatial Point Patterns Analysis to discover the geographical distribution of Grab’s hailing services in Singapore</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415 Course Website</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-On Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../Hands-On_Exercise/Hands-On_Exercise_01/Hands-On_Exercise_01.html">
 <span class="dropdown-text">Hands-On Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Exercise/Hands-On_Exercise_02/Hands-On_Exercise_02.html">
 <span class="dropdown-text">Hands-On Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Exercise/Hands-On_Exercise_03/Hands-On_Exercise_03.html">
 <span class="dropdown-text">Hands-On Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Exercise/Hands-On_Exercise_04/Hands-On_Exercise_04.html">
 <span class="dropdown-text">Hands-On Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Exercise/Hands-On_Exercise_05/Hands-On_Exercise_05.html">
 <span class="dropdown-text">Hands-On Exercise 5</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-Class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../In-Class_Exercise/In-Class_Exercise_02/In-Class_Exercise_02.html">
 <span class="dropdown-text">In-Class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Exercise/In-Class_Exercise_03/In-Class_Exercise_03.html">
 <span class="dropdown-text">In-Class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Exercise/In-Class_Exercise_04/In-Class_Exercise_04.html">
 <span class="dropdown-text">In-Class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Exercise/In-Class_Exercise_05/In-Class_Exercise_05.html">
 <span class="dropdown-text">In-Class Exercise 5</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-Home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../Take-Home_Exercise/Take-Home_Exercise_01/Take-Home_Exercise_01.html">
 <span class="dropdown-text">Take-Home Exercise 1</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#loading-the-necessary-r-packages" id="toc-loading-the-necessary-r-packages" class="nav-link active" data-scroll-target="#loading-the-necessary-r-packages">Loading the necessary R-packages</a></li>
  <li><a href="#importing-the-datasets-of-interest" id="toc-importing-the-datasets-of-interest" class="nav-link" data-scroll-target="#importing-the-datasets-of-interest">Importing the datasets of interest</a></li>
  <li><a href="#visualising-the-grab-posisi-origins-data-in-interactive-view" id="toc-visualising-the-grab-posisi-origins-data-in-interactive-view" class="nav-link" data-scroll-target="#visualising-the-grab-posisi-origins-data-in-interactive-view">Visualising the Grab-Posisi origins data in interactive view</a></li>
  <li><a href="#extracting-the-central-region-polygons" id="toc-extracting-the-central-region-polygons" class="nav-link" data-scroll-target="#extracting-the-central-region-polygons">Extracting the “Central Region” polygons</a></li>
  <li><a href="#filtering-down-the-grab-call-origins-data-to-match-out-study-area" id="toc-filtering-down-the-grab-call-origins-data-to-match-out-study-area" class="nav-link" data-scroll-target="#filtering-down-the-grab-call-origins-data-to-match-out-study-area">Filtering down the Grab call origins data to match out study area</a></li>
  <li><a href="#visualising-the-origins-of-grab-trips-over-the-weekends-and-weekdays-in-the-central-region-of-singapore." id="toc-visualising-the-origins-of-grab-trips-over-the-weekends-and-weekdays-in-the-central-region-of-singapore." class="nav-link" data-scroll-target="#visualising-the-origins-of-grab-trips-over-the-weekends-and-weekdays-in-the-central-region-of-singapore.">Visualising the origins of Grab trips over the weekends and weekdays in the Central Region of Singapore.</a></li>
  <li><a href="#transforming-the-filtered-grab-origins-data-into-spatial-points-generic-sp-and-ppp-objects" id="toc-transforming-the-filtered-grab-origins-data-into-spatial-points-generic-sp-and-ppp-objects" class="nav-link" data-scroll-target="#transforming-the-filtered-grab-origins-data-into-spatial-points-generic-sp-and-ppp-objects">Transforming the filtered Grab origins data into <em>Spatial Points</em>, generic <em>sp</em> and <em>ppp</em> objects</a></li>
  <li><a href="#scaling-the-ppp-objects-to-km-for-more-discernable-patterns-when-we-produce-the-kernel-density-estimates" id="toc-scaling-the-ppp-objects-to-km-for-more-discernable-patterns-when-we-produce-the-kernel-density-estimates" class="nav-link" data-scroll-target="#scaling-the-ppp-objects-to-km-for-more-discernable-patterns-when-we-produce-the-kernel-density-estimates">Scaling the <em>ppp</em> objects to “km” for more discernable patterns when we produce the kernel density estimates</a></li>
  <li><a href="#using-the-diggle-method-to-conduct-the-kernel-density-estimations" id="toc-using-the-diggle-method-to-conduct-the-kernel-density-estimations" class="nav-link" data-scroll-target="#using-the-diggle-method-to-conduct-the-kernel-density-estimations">Using the <strong><em>Diggle</em></strong> method to conduct the Kernel Density Estimations</a></li>
  <li><a href="#using-the-adaptive-bandwidth-method-to-conduct-the-kernel-density-estimations" id="toc-using-the-adaptive-bandwidth-method-to-conduct-the-kernel-density-estimations" class="nav-link" data-scroll-target="#using-the-adaptive-bandwidth-method-to-conduct-the-kernel-density-estimations">Using the <strong><em>Adaptive Bandwidth</em></strong> method to conduct the Kernel Density Estimations</a></li>
  <li><a href="#conducting-the-clark-evans-test-for-spatial-point-pattern" id="toc-conducting-the-clark-evans-test-for-spatial-point-pattern" class="nav-link" data-scroll-target="#conducting-the-clark-evans-test-for-spatial-point-pattern">Conducting the Clark-Evans test for Spatial Point Pattern</a></li>
  <li><a href="#limiting-the-road-network-data-to-central-singapore" id="toc-limiting-the-road-network-data-to-central-singapore" class="nav-link" data-scroll-target="#limiting-the-road-network-data-to-central-singapore">Limiting the Road Network Data to Central Singapore</a></li>
  <li><a href="#preparing-the-lixel-objects-and-generating-the-line-centre-points" id="toc-preparing-the-lixel-objects-and-generating-the-line-centre-points" class="nav-link" data-scroll-target="#preparing-the-lixel-objects-and-generating-the-line-centre-points">Preparing the lixel objects and generating the line centre points</a></li>
  <li><a href="#performing-the-network-constrained-kernel-density-estimation" id="toc-performing-the-network-constrained-kernel-density-estimation" class="nav-link" data-scroll-target="#performing-the-network-constrained-kernel-density-estimation">Performing the Network Constrained Kernel Density Estimation</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-Home Exercise 1: Application of Spatial Point Patterns Analysis to discover the geographical distribution of Grab’s hailing services in Singapore</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Yung Qi Yang </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 6, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="loading-the-necessary-r-packages" class="level3">
<h3 class="anchored" data-anchor-id="loading-the-necessary-r-packages">Loading the necessary R-packages</h3>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, tidyverse, arrow, lubridate, tmap, maptools, spatstat, spNetwork, htmlwidgets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="importing-the-datasets-of-interest" class="level3">
<h3 class="anchored" data-anchor-id="importing-the-datasets-of-interest">Importing the datasets of interest</h3>
<section id="grab-posisi-data" class="level4">
<h4 class="anchored" data-anchor-id="grab-posisi-data">Grab-Posisi Data:</h4>
<p>The Grab-Posisi data is contained within 10 segmented parquet files, thus, the <em>read_parquet</em> function from the <em>Arrow</em> package is required. Upon loading, the files are combined into 1 large dataset and saved.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>grab_df <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(<span class="st">"Data/Geospatial/GrabPosisi/part-00000-8bbff892-97d2-4011-9961-703e38972569.c000.snappy.parquet"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>) {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  grab_df <span class="ot">&lt;-</span> grab_df <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(<span class="fu">read_parquet</span>(<span class="fu">paste0</span>(<span class="st">"Data/Geospatial/GrabPosisi/part-0000"</span>, <span class="fu">as.character</span>(i), <span class="st">"-8bbff892-97d2-4011-9961-703e38972569.c000.snappy.parquet"</span>)))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can see that the Grab-Posisi dataset in its entirety is way too large for computation.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(grab_df)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>grab_df<span class="sc">$</span>pingtimestamp <span class="ot">&lt;-</span> <span class="fu">as_datetime</span>(grab_df<span class="sc">$</span>pingtimestamp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="Screenshots/Grab_Posisi_Data_Glimpse.png" class="img-fluid"></p>
<p>Grab-Posisi is stored here in case there is a need for it in its entirety.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_parquet</span>(grab_df, <span class="st">"Data/Geospatial/GrabPosisi/Grab_Posisi.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As we are interested in the analysis of only the origins of Grab calls in Singapore, the Grab-Posisi data is subset here to reduce the size of the dataframe in the R-Environment to the necessary only.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>grab_origin_df <span class="ot">&lt;-</span> grab_df <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(trj_id) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(pingtimestamp) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weekday =</span> <span class="fu">wday</span>(pingtimestamp, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">TRUE</span>), <span class="at">start_hr =</span> <span class="fu">factor</span>(<span class="fu">hour</span>(pingtimestamp)), <span class="at">day =</span> <span class="fu">factor</span>(<span class="fu">mday</span>(pingtimestamp)))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(grab_origin_df)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(grab_origin_df, <span class="st">"Data/Geospatial/RDS/Grab_Origins_Posisi.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="Screenshots/Grab_Origins_Data_Glimpse.png" class="img-fluid"></p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>grab_origin_df <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"Data/Geospatial/RDS/Grab_Origins_Posisi.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="singapore-planning-zone-and-road-network-data" class="level4">
<h4 class="anchored" data-anchor-id="singapore-planning-zone-and-road-network-data">Singapore Planning Zone and Road Network Data</h4>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mpsz2019 <span class="ot">&lt;-</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_read</span>(<span class="st">"Data/Geospatial/MPSZ-2019"</span>, <span class="at">layer =</span> <span class="st">"MPSZ-2019"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `MPSZ-2019' from data source 
  `C:\Users\yungq\Desktop\SMU Modules\Y4S1\Geospatial Analysis and Applications\IS415 Course Website\Take-Home_Exercise\Take-Home_Exercise_01\Data\Geospatial\MPSZ-2019' 
  using driver `ESRI Shapefile'
Simple feature collection with 332 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 103.6057 ymin: 1.158699 xmax: 104.0885 ymax: 1.470775
Geodetic CRS:  WGS 84</code></pre>
</div>
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mpsz2019)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  SUBZONE_N          SUBZONE_C          PLN_AREA_N         PLN_AREA_C       
 Length:332         Length:332         Length:332         Length:332        
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
   REGION_N           REGION_C                  geometry  
 Length:332         Length:332         MULTIPOLYGON :332  
 Class :character   Class :character   epsg:3414    :  0  
 Mode  :character   Mode  :character   +proj=tmer...:  0  </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_read</span>(<span class="st">"Data/Geospatial/OSM"</span>, <span class="at">layer =</span> <span class="st">"gis_osm_roads_free_1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(roads)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="Screenshots/OSM_Road_Network.png" class="img-fluid"></p>
<p>Plotting the Master-Plan Subzone geospatial data for visualisation</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mpsz2019_plot <span class="ot">&lt;-</span> mpsz2019 <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"lightyellow"</span>, <span class="at">border.col =</span> <span class="st">"navy"</span>) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Singapore Master Plan Boundaries 2019"</span>, <span class="at">main.title.size =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">tm_compass</span>(<span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_save</span>(<span class="at">tm =</span> mpsz2019_plot, <span class="st">"Screenshots/mpsz2019.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="Screenshots/mpsz2019.png" class="img-fluid"></p>
<p>From the plot, we can see that the Master-Plan Subzone Data includes the outer islands of Singapore.</p>
<p>To observe if it is impactful, we plot the road network upon the previous layer.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>mpsz_w_roads2019_plot <span class="ot">&lt;-</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(mpsz2019) <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"lightyellow"</span>, <span class="at">border.col =</span> <span class="st">"orange"</span>, <span class="at">border.alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Singapore Road Network 2019"</span>, <span class="at">main.title.size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(roads) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>()</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_save</span>(<span class="at">tm =</span> mpsz_w_roads2019_plot, <span class="st">"Screenshots/mpsz_w_roads2019.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="Screenshots/mpsz_w_roads2019.png" class="img-fluid"></p>
<p>Here we can observe that there are road networks present outside the mainland in the dataset. Thus, we need to remove them if mainland Singapore is the scope of the study. First though, we should investigate the Grab-Posisi Data further.</p>
</section>
<section id="transforming-the-grab-posisi-data-into-a-simple-features-object" class="level4">
<h4 class="anchored" data-anchor-id="transforming-the-grab-posisi-data-into-a-simple-features-object">Transforming the Grab-Posisi Data into a <em>simple features</em> object</h4>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>grab_origin_sf <span class="ot">&lt;-</span> grab_origin_df <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"rawlng"</span>, <span class="st">"rawlat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(grab_origin_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    trj_id          driving_mode          osname         
 Length:28000       Length:28000       Length:28000      
 Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character  
                                                         
                                                         
                                                         
                                                         
 pingtimestamp                        speed           bearing     
 Min.   :2019-04-08 00:09:26.00   Min.   :-1.000   Min.   :  0.0  
 1st Qu.:2019-04-11 08:48:29.25   1st Qu.: 3.590   1st Qu.: 90.0  
 Median :2019-04-15 00:08:48.00   Median : 9.945   Median :179.0  
 Mean   :2019-04-14 21:29:59.93   Mean   : 9.566   Mean   :172.5  
 3rd Qu.:2019-04-18 10:47:59.25   3rd Qu.:14.550   3rd Qu.:256.0  
 Max.   :2019-04-21 23:33:28.00   Max.   :30.949   Max.   :359.0  
                                                                  
    accuracy       weekday       start_hr          day       
 Min.   :  1.000   Sun:3983   9      : 2104   17     : 2012  
 1st Qu.:  3.900   Mon:3975   10     : 2104   18     : 2008  
 Median :  6.000   Tue:4008   0      : 1941   12     : 2007  
 Mean   :  7.617   Wed:4016   1      : 1919   9      : 2004  
 3rd Qu.: 10.000   Thu:4008   8      : 1541   16     : 2004  
 Max.   :728.000   Fri:4002   7      : 1539   13     : 2004  
                   Sat:4008   (Other):16852   (Other):15961  
          geometry    
 POINT        :28000  
 epsg:3414    :    0  
 +proj=tmer...:    0  
                      
                      
                      
                      </code></pre>
</div>
</div>
</section>
<section id="transforming-the-grab-posisi-data-furthur-into-spatial-points-generic-sp-and-ppp-objects" class="level4">
<h4 class="anchored" data-anchor-id="transforming-the-grab-posisi-data-furthur-into-spatial-points-generic-sp-and-ppp-objects">Transforming the Grab-Posisi data furthur into <em>Spatial Points</em>, generic <em>sp</em> and <em>ppp</em> objects</h4>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>grab_origin_spatial <span class="ot">&lt;-</span> grab_origin_sf <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_Spatial</span>()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(grab_origin_spatial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Object of class SpatialPointsDataFrame
Coordinates:
                min      max
coords.x1  3628.243 49845.23
coords.x2 25198.140 49689.64
Is projected: TRUE 
proj4string :
[+proj=tmerc +lat_0=1.36666666666667 +lon_0=103.833333333333 +k=1
+x_0=28001.642 +y_0=38744.572 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0
+units=m +no_defs]
Number of points: 28000
Data attributes:
    trj_id          driving_mode          osname         
 Length:28000       Length:28000       Length:28000      
 Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character  
                                                         
                                                         
                                                         
                                                         
 pingtimestamp                        speed           bearing     
 Min.   :2019-04-08 00:09:26.00   Min.   :-1.000   Min.   :  0.0  
 1st Qu.:2019-04-11 08:48:29.25   1st Qu.: 3.590   1st Qu.: 90.0  
 Median :2019-04-15 00:08:48.00   Median : 9.945   Median :179.0  
 Mean   :2019-04-14 21:29:59.93   Mean   : 9.566   Mean   :172.5  
 3rd Qu.:2019-04-18 10:47:59.25   3rd Qu.:14.550   3rd Qu.:256.0  
 Max.   :2019-04-21 23:33:28.00   Max.   :30.949   Max.   :359.0  
                                                                  
    accuracy       weekday       start_hr          day       
 Min.   :  1.000   Sun:3983   9      : 2104   17     : 2012  
 1st Qu.:  3.900   Mon:3975   10     : 2104   18     : 2008  
 Median :  6.000   Tue:4008   0      : 1941   12     : 2007  
 Mean   :  7.617   Wed:4016   1      : 1919   9      : 2004  
 3rd Qu.: 10.000   Thu:4008   8      : 1541   16     : 2004  
 Max.   :728.000   Fri:4002   7      : 1539   13     : 2004  
                   Sat:4008   (Other):16852   (Other):15961  </code></pre>
</div>
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>grab_origin_sp <span class="ot">&lt;-</span> grab_origin_spatial <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as</span>(<span class="st">"SpatialPoints"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(grab_origin_sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Object of class SpatialPoints
Coordinates:
                min      max
coords.x1  3628.243 49845.23
coords.x2 25198.140 49689.64
Is projected: TRUE 
proj4string :
[+proj=tmerc +lat_0=1.36666666666667 +lon_0=103.833333333333 +k=1
+x_0=28001.642 +y_0=38744.572 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0
+units=m +no_defs]
Number of points: 28000</code></pre>
</div>
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>grab_origin_ppp <span class="ot">&lt;-</span> grab_origin_sp <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as</span>(<span class="st">"ppp"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(grab_origin_ppp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Planar point pattern:  28000 points
Average intensity 2.473666e-05 points per square unit

Coordinates are given to 3 decimal places
i.e. rounded to the nearest multiple of 0.001 units

Window: rectangle = [3628.24, 49845.23] x [25198.14, 49689.64] units
                    (46220 x 24490 units)
Window area = 1131920000 square units</code></pre>
</div>
</div>
</section>
</section>
<section id="visualising-the-grab-posisi-origins-data-in-interactive-view" class="level3">
<h3 class="anchored" data-anchor-id="visualising-the-grab-posisi-origins-data-in-interactive-view">Visualising the Grab-Posisi origins data in interactive view</h3>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>grab_origins_interactive <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(grab_origin_sf) <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="fl">0.03</span>, <span class="at">col =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Grab-Posisi Origin points across Singapore"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>grab_origins_interactive <span class="ot">=</span> <span class="fu">tmap_leaflet</span>(grab_origins_interactive)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">saveWidget</span>(<span class="at">widget =</span> grab_origins_interactive, <span class="at">file =</span> <span class="st">"Screenshots/grab_origins_interactive.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!--html_preserve-->
<p><iframe src="Screenshots/grab_origins_interactive.html" width="600" height="400"> </iframe></p>
<!--html_preserve-->
<p>If we zoom in, it appears that there are little to no overlaps in the point coordinates in the data. To confirm,</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">duplicated</span>(grab_origin_ppp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>This is good as there is no need to account for point duplication in the dataset.</p>
<p>Now, we visualise the spread of the point of origins of Grab calls in Singapore.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>grab_origin_sg_plot <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(coastal_outline) <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"lightyellow"</span>, <span class="at">border.col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Origins of Grab Trips in Singapore (within Mainland only)"</span>) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(grab_origin_sf) <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_save</span>(grab_origin_sg_plot, <span class="st">"Screenshots/Grab_Origins_SG.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="Screenshots/Grab_Origins_SG.png" class="img-fluid"></p>
<p>It is clear that the central region of Singapore handles more calls than other parts of the country. This of course makes sense as the central region is where the central business district lies, and considering the difference in cost of Grab vs.&nbsp;other forms of public transport, it should be expected that most customers of Grab fall within the CBD area.</p>
<p>Considering the size of the datasets and the complexity of the road network, it makes sense to try to limit the area of study so our machines can handle the computation reasonably. Considering the spread of the data, the central region is chosen as it focus area.</p>
</section>
<section id="extracting-the-central-region-polygons" class="level3">
<h3 class="anchored" data-anchor-id="extracting-the-central-region-polygons">Extracting the “Central Region” polygons</h3>
<p>Only specific polygons within the “Central Region” is chosen to further narrow down the scope of study to a feasible size.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>central_sg <span class="ot">&lt;-</span> mpsz2019[mpsz2019<span class="sc">$</span>PLN_AREA_N <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"DOWNTOWN CORE"</span>, <span class="st">"MARINA EAST"</span>, <span class="st">"MARINA SOUTH"</span>, <span class="st">"MUSEUM"</span>, <span class="st">"NEWTON"</span>, <span class="st">"ORCHARD"</span>, <span class="st">"OUTRAM"</span>, <span class="st">"RIVER VALLEY"</span>, <span class="st">"ROCHOR"</span>, <span class="st">"SINGAPORE RIVER"</span>, <span class="st">"STRAITS VIEW"</span>), ]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(central_sg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  SUBZONE_N          SUBZONE_C          PLN_AREA_N         PLN_AREA_C       
 Length:50          Length:50          Length:50          Length:50         
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
   REGION_N           REGION_C                  geometry 
 Length:50          Length:50          MULTIPOLYGON :50  
 Class :character   Class :character   epsg:3414    : 0  
 Mode  :character   Mode  :character   +proj=tmer...: 0  </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>central_region_plot <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(mpsz2019) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"lightyellow"</span>, <span class="at">border.col =</span> <span class="st">"navy"</span>) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Central Region of Singapore"</span>) <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(central_sg) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"orange"</span>, <span class="at">border.col =</span> <span class="st">"red"</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_save</span>(central_region_plot, <span class="st">"Screenshots/central_region_SG.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="Screenshots/central_region_SG.png" class="img-fluid"></p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>central_sg <span class="ot">&lt;-</span> <span class="fu">st_union</span>(central_sg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>central_region_SG_outline <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(mpsz2019) <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"lightyellow"</span>, <span class="at">border.col =</span> <span class="st">"navy"</span>) <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Central Region of Singapore"</span>) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(central_sg) <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"orange"</span>, <span class="at">border.col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_save</span>(central_region_SG_outline, <span class="st">"Screenshots/central_region_SG_outline.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="Screenshots/central_region_SG_outline.png" class="img-fluid"></p>
</section>
<section id="filtering-down-the-grab-call-origins-data-to-match-out-study-area" class="level3">
<h3 class="anchored" data-anchor-id="filtering-down-the-grab-call-origins-data-to-match-out-study-area">Filtering down the Grab call origins data to match out study area</h3>
<p>One interesting point of study might be the difference in calls between the weekends and weekdays. Most offices are closed on the weekends, so it might be interesting to investigate how the data differs between the time periods. Thus, we also break the data into 2 parts apart from limiting its geographical scope.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>grab_weekend <span class="ot">&lt;-</span> grab_origin_sf[grab_origin_sf<span class="sc">$</span>weekday <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sun"</span>, <span class="st">"Sat"</span>), ]</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>grab_weekday <span class="ot">&lt;-</span> grab_origin_sf[<span class="sc">!</span>grab_origin_sf<span class="sc">$</span>weekday <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sun"</span>, <span class="st">"Sat"</span>), ]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>central_grab_weekend_sf <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(grab_weekend, central_sg)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>central_grab_weekday_sf <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(grab_weekday, central_sg)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(central_grab_weekend_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    trj_id          driving_mode          osname         
 Length:698         Length:698         Length:698        
 Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character  
                                                         
                                                         
                                                         
                                                         
 pingtimestamp                        speed           bearing     
 Min.   :2019-04-13 00:31:23.00   Min.   :-1.000   Min.   :  0.0  
 1st Qu.:2019-04-13 16:50:57.00   1st Qu.: 3.417   1st Qu.: 53.0  
 Median :2019-04-14 14:02:41.00   Median : 8.527   Median :172.5  
 Mean   :2019-04-17 02:11:19.36   Mean   : 8.497   Mean   :172.9  
 3rd Qu.:2019-04-20 15:51:27.25   3rd Qu.:13.170   3rd Qu.:299.0  
 Max.   :2019-04-21 23:25:40.00   Max.   :24.620   Max.   :358.0  
                                                                  
    accuracy       weekday      start_hr        day               geometry  
 Min.   :  2.000   Sun:308   7      : 57   13     :209   POINT        :698  
 1st Qu.:  4.354   Mon:  0   5      : 54   20     :181   epsg:3414    :  0  
 Median :  8.788   Tue:  0   13     : 47   14     :167   +proj=tmer...:  0  
 Mean   : 10.932   Wed:  0   6      : 46   21     :141                      
 3rd Qu.: 13.490   Thu:  0   8      : 41   9      :  0                      
 Max.   :100.000   Fri:  0   11     : 40   16     :  0                      
                   Sat:390   (Other):413   (Other):  0                      </code></pre>
</div>
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(central_grab_weekday_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    trj_id          driving_mode          osname         
 Length:2335        Length:2335        Length:2335       
 Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character  
                                                         
                                                         
                                                         
                                                         
 pingtimestamp                        speed           bearing     
 Min.   :2019-04-08 00:09:48.00   Min.   :-1.000   Min.   :  0.0  
 1st Qu.:2019-04-10 09:36:16.50   1st Qu.: 2.631   1st Qu.: 48.5  
 Median :2019-04-12 22:38:39.00   Median : 7.583   Median :152.0  
 Mean   :2019-04-13 23:06:58.46   Mean   : 7.821   Mean   :166.7  
 3rd Qu.:2019-04-17 12:29:12.50   3rd Qu.:12.196   3rd Qu.:293.0  
 Max.   :2019-04-19 23:12:41.00   Max.   :26.160   Max.   :359.0  
                                                                  
    accuracy       weekday      start_hr         day               geometry   
 Min.   :  2.000   Sun:  0   11     : 237   18     :301   POINT        :2335  
 1st Qu.:  4.141   Mon:441   10     : 228   17     :251   epsg:3414    :   0  
 Median :  8.576   Tue:454   9      : 225   12     :251   +proj=tmer...:   0  
 Mean   : 11.581   Wed:457   13     : 175   9      :243                       
 3rd Qu.: 13.000   Thu:540   12     : 155   11     :239                       
 Max.   :728.000   Fri:443   14     : 147   8      :234                       
                   Sat:  0   (Other):1168   (Other):816                       </code></pre>
</div>
</div>
</section>
<section id="visualising-the-origins-of-grab-trips-over-the-weekends-and-weekdays-in-the-central-region-of-singapore." class="level3">
<h3 class="anchored" data-anchor-id="visualising-the-origins-of-grab-trips-over-the-weekends-and-weekdays-in-the-central-region-of-singapore.">Visualising the origins of Grab trips over the weekends and weekdays in the Central Region of Singapore.</h3>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>grab_central_weekday_plot <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(central_sg) <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"lightyellow"</span>, <span class="at">border.col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Origins of Weekday Grab Trips in Singapore (within Central Region only)"</span>, <span class="at">main.title.size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(central_grab_weekday_sf) <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>grab_central_weekend_plot <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(central_sg) <span class="sc">+</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"lightyellow"</span>, <span class="at">border.col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Origins of Weekend Grab Trips in Singapore (within Central Region only)"</span>, <span class="at">main.title.size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(central_grab_weekend_sf) <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_save</span>(grab_central_weekday_plot, <span class="st">"Screenshots/grab_central_weekday_plot.png"</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_save</span>(grab_central_weekend_plot, <span class="st">"Screenshots/grab_central_weekend_plot.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="Screenshots/grab_central_weekday_plot.png" class="img-fluid"></p>
<p><img src="Screenshots/grab_central_weekend_plot.png" class="img-fluid"></p>
<p>It appears that on the weekends, calls not only originate from the central region far less often, but also become more sparsely spread out. This makes sense as the central region encompasses subzones outside the CBD, so as the weekend comes, even though calls may fall off in the CBD, these subzones will remain steady. Thus, contributing to the more even distribution observed.</p>
</section>
<section id="transforming-the-filtered-grab-origins-data-into-spatial-points-generic-sp-and-ppp-objects" class="level3">
<h3 class="anchored" data-anchor-id="transforming-the-filtered-grab-origins-data-into-spatial-points-generic-sp-and-ppp-objects">Transforming the filtered Grab origins data into <em>Spatial Points</em>, generic <em>sp</em> and <em>ppp</em> objects</h3>
<section id="for-the-weekend" class="level4">
<h4 class="anchored" data-anchor-id="for-the-weekend">For the Weekend:</h4>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>central_grab_weekend_spatial <span class="ot">&lt;-</span> central_grab_weekend_sf <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_Spatial</span>()</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(central_grab_weekend_spatial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Object of class SpatialPointsDataFrame
Coordinates:
               min      max
coords.x1 26935.13 31786.09
coords.x2 27890.04 32876.01
Is projected: TRUE 
proj4string :
[+proj=tmerc +lat_0=1.36666666666667 +lon_0=103.833333333333 +k=1
+x_0=28001.642 +y_0=38744.572 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0
+units=m +no_defs]
Number of points: 698
Data attributes:
    trj_id          driving_mode          osname         
 Length:698         Length:698         Length:698        
 Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character  
                                                         
                                                         
                                                         
                                                         
 pingtimestamp                        speed           bearing     
 Min.   :2019-04-13 00:31:23.00   Min.   :-1.000   Min.   :  0.0  
 1st Qu.:2019-04-13 16:50:57.00   1st Qu.: 3.417   1st Qu.: 53.0  
 Median :2019-04-14 14:02:41.00   Median : 8.527   Median :172.5  
 Mean   :2019-04-17 02:11:19.36   Mean   : 8.497   Mean   :172.9  
 3rd Qu.:2019-04-20 15:51:27.25   3rd Qu.:13.170   3rd Qu.:299.0  
 Max.   :2019-04-21 23:25:40.00   Max.   :24.620   Max.   :358.0  
                                                                  
    accuracy       weekday      start_hr        day     
 Min.   :  2.000   Sun:308   7      : 57   13     :209  
 1st Qu.:  4.354   Mon:  0   5      : 54   20     :181  
 Median :  8.788   Tue:  0   13     : 47   14     :167  
 Mean   : 10.932   Wed:  0   6      : 46   21     :141  
 3rd Qu.: 13.490   Thu:  0   8      : 41   9      :  0  
 Max.   :100.000   Fri:  0   11     : 40   16     :  0  
                   Sat:390   (Other):413   (Other):  0  </code></pre>
</div>
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>central_grab_weekend_sp <span class="ot">&lt;-</span> central_grab_weekend_spatial <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as</span>(<span class="st">"SpatialPoints"</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(central_grab_weekend_sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Object of class SpatialPoints
Coordinates:
               min      max
coords.x1 26935.13 31786.09
coords.x2 27890.04 32876.01
Is projected: TRUE 
proj4string :
[+proj=tmerc +lat_0=1.36666666666667 +lon_0=103.833333333333 +k=1
+x_0=28001.642 +y_0=38744.572 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0
+units=m +no_defs]
Number of points: 698</code></pre>
</div>
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>central_grab_weekend_ppp <span class="ot">&lt;-</span> central_grab_weekend_sp <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as</span>(<span class="st">"ppp"</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(central_grab_weekend_ppp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Planar point pattern:  698 points
Average intensity 2.885876e-05 points per square unit

Coordinates are given to 3 decimal places
i.e. rounded to the nearest multiple of 0.001 units

Window: rectangle = [26935.13, 31786.09] x [27890.04, 32876.01] units
                    (4851 x 4986 units)
Window area = 24186800 square units</code></pre>
</div>
</div>
</section>
<section id="for-the-weekdays" class="level4">
<h4 class="anchored" data-anchor-id="for-the-weekdays">For the Weekdays:</h4>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>central_grab_weekday_spatial <span class="ot">&lt;-</span> central_grab_weekday_sf <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_Spatial</span>()</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(central_grab_weekday_spatial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Object of class SpatialPointsDataFrame
Coordinates:
               min      max
coords.x1 26902.48 32829.73
coords.x2 28050.48 33252.24
Is projected: TRUE 
proj4string :
[+proj=tmerc +lat_0=1.36666666666667 +lon_0=103.833333333333 +k=1
+x_0=28001.642 +y_0=38744.572 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0
+units=m +no_defs]
Number of points: 2335
Data attributes:
    trj_id          driving_mode          osname         
 Length:2335        Length:2335        Length:2335       
 Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character  
                                                         
                                                         
                                                         
                                                         
 pingtimestamp                        speed           bearing     
 Min.   :2019-04-08 00:09:48.00   Min.   :-1.000   Min.   :  0.0  
 1st Qu.:2019-04-10 09:36:16.50   1st Qu.: 2.631   1st Qu.: 48.5  
 Median :2019-04-12 22:38:39.00   Median : 7.583   Median :152.0  
 Mean   :2019-04-13 23:06:58.46   Mean   : 7.821   Mean   :166.7  
 3rd Qu.:2019-04-17 12:29:12.50   3rd Qu.:12.196   3rd Qu.:293.0  
 Max.   :2019-04-19 23:12:41.00   Max.   :26.160   Max.   :359.0  
                                                                  
    accuracy       weekday      start_hr         day     
 Min.   :  2.000   Sun:  0   11     : 237   18     :301  
 1st Qu.:  4.141   Mon:441   10     : 228   17     :251  
 Median :  8.576   Tue:454   9      : 225   12     :251  
 Mean   : 11.581   Wed:457   13     : 175   9      :243  
 3rd Qu.: 13.000   Thu:540   12     : 155   11     :239  
 Max.   :728.000   Fri:443   14     : 147   8      :234  
                   Sat:  0   (Other):1168   (Other):816  </code></pre>
</div>
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>central_grab_weekday_sp <span class="ot">&lt;-</span> central_grab_weekday_spatial <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as</span>(<span class="st">"SpatialPoints"</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(central_grab_weekday_sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Object of class SpatialPoints
Coordinates:
               min      max
coords.x1 26902.48 32829.73
coords.x2 28050.48 33252.24
Is projected: TRUE 
proj4string :
[+proj=tmerc +lat_0=1.36666666666667 +lon_0=103.833333333333 +k=1
+x_0=28001.642 +y_0=38744.572 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0
+units=m +no_defs]
Number of points: 2335</code></pre>
</div>
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>central_grab_weekday_ppp <span class="ot">&lt;-</span> central_grab_weekday_sp <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as</span>(<span class="st">"ppp"</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(central_grab_weekday_ppp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Planar point pattern:  2335 points
Average intensity 7.573262e-05 points per square unit

Coordinates are given to 3 decimal places
i.e. rounded to the nearest multiple of 0.001 units

Window: rectangle = [26902.48, 32829.73] x [28050.48, 33252.24] units
                    (5927 x 5202 units)
Window area = 30832200 square units</code></pre>
</div>
</div>
</section>
</section>
<section id="scaling-the-ppp-objects-to-km-for-more-discernable-patterns-when-we-produce-the-kernel-density-estimates" class="level3">
<h3 class="anchored" data-anchor-id="scaling-the-ppp-objects-to-km-for-more-discernable-patterns-when-we-produce-the-kernel-density-estimates">Scaling the <em>ppp</em> objects to “km” for more discernable patterns when we produce the kernel density estimates</h3>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>central_grab_weekend_ppp.km <span class="ot">&lt;-</span> <span class="fu">rescale</span>(central_grab_weekend_ppp, <span class="dv">1000</span>, <span class="st">"km"</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>central_grab_weekday_ppp.km <span class="ot">&lt;-</span> <span class="fu">rescale</span>(central_grab_weekday_ppp, <span class="dv">1000</span>, <span class="st">"km"</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(central_grab_weekend_ppp.km)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Planar point pattern:  698 points
Average intensity 28.85876 points per square km

Coordinates are given to 6 decimal places

Window: rectangle = [26.93513, 31.78609] x [27.89004, 32.87601] km
                    (4.851 x 4.986 km)
Window area = 24.1868 square km
Unit of length: 1 km</code></pre>
</div>
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(central_grab_weekday_ppp.km)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Planar point pattern:  2335 points
Average intensity 75.73262 points per square km

Coordinates are given to 6 decimal places

Window: rectangle = [26.90248, 32.82973] x [28.05048, 33.25224] km
                    (5.927 x 5.202 km)
Window area = 30.8322 square km
Unit of length: 1 km</code></pre>
</div>
</div>
</section>
<section id="using-the-diggle-method-to-conduct-the-kernel-density-estimations" class="level3">
<h3 class="anchored" data-anchor-id="using-the-diggle-method-to-conduct-the-kernel-density-estimations">Using the <strong><em>Diggle</em></strong> method to conduct the Kernel Density Estimations</h3>
<p>Diggle method is favoured here because the pre-emptive visualisation showed us that the call origins are clustered in multiple regions on weekdays and highly dispersed on weekends.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">cex.main =</span> <span class="fl">0.5</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>kde_central_grab_weekend_diggle_bw.km <span class="ot">&lt;-</span> <span class="fu">density</span>(central_grab_weekend_ppp.km, <span class="at">sigma=</span>bw.diggle, <span class="at">edge=</span><span class="cn">TRUE</span>, <span class="at">kernel=</span><span class="st">"gaussian"</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>kde_central_grab_weekday_diggle_bw.km <span class="ot">&lt;-</span> <span class="fu">density</span>(central_grab_weekday_ppp.km, <span class="at">sigma=</span>bw.diggle, <span class="at">edge=</span><span class="cn">TRUE</span>, <span class="at">kernel=</span><span class="st">"gaussian"</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kde_central_grab_weekend_diggle_bw.km, <span class="at">main =</span> <span class="st">"Scaled Kernel Density Estimate of Grab Trip Origins in Central SG on Weekends (Diggle)"</span>)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kde_central_grab_weekday_diggle_bw.km, <span class="at">main =</span> <span class="st">"Scaled Kernel Density Estimate of Grab Trip Origins in Central SG on Weekdays (Diggle)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Exercise_01_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="using-the-adaptive-bandwidth-method-to-conduct-the-kernel-density-estimations" class="level3">
<h3 class="anchored" data-anchor-id="using-the-adaptive-bandwidth-method-to-conduct-the-kernel-density-estimations">Using the <strong><em>Adaptive Bandwidth</em></strong> method to conduct the Kernel Density Estimations</h3>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">cex.main =</span> <span class="fl">0.4</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>kde_central_grab_weekend_ppp_adaptive <span class="ot">&lt;-</span> <span class="fu">adaptive.density</span>(central_grab_weekend_ppp.km, <span class="at">method=</span><span class="st">"kernel"</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>kde_central_grab_weekday_ppp_adaptive <span class="ot">&lt;-</span> <span class="fu">adaptive.density</span>(central_grab_weekday_ppp.km, <span class="at">method=</span><span class="st">"kernel"</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kde_central_grab_weekend_ppp_adaptive, <span class="at">main =</span> <span class="st">"Kernel Density Estimate of Grab Trip Origins in central SG on weekends (adaptive bandwidth)"</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kde_central_grab_weekday_ppp_adaptive, <span class="at">main =</span> <span class="st">"Kernel Density Estimate of Grab Trip Origins in central SG on weekdays (adaptive bandwidth)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Exercise_01_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The KDE plots here become especially useful as it shows how the previous simple plot of the Grab trip origins can be misleading. Here, the KDE estimates tells us that the distribution of the trip origins still happen to be heavily skewed towards what should be the CBD area of Singapore regardless of the part of the week. Whereas, previous plots, probably as a result of lower volume would have us believe that there is the difference in spread.</p>
</section>
<section id="conducting-the-clark-evans-test-for-spatial-point-pattern" class="level3">
<h3 class="anchored" data-anchor-id="conducting-the-clark-evans-test-for-spatial-point-pattern">Conducting the Clark-Evans test for Spatial Point Pattern</h3>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">clarkevans.test</span>(central_grab_weekday_ppp.km, <span class="at">correction=</span><span class="st">"none"</span>, <span class="at">clipregion=</span><span class="st">"central_sg_owin"</span>, <span class="at">alternative=</span><span class="fu">c</span>(<span class="st">"clustered"</span>), <span class="at">nsim=</span><span class="dv">99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Clark-Evans test
    No edge correction
    Z-test

data:  central_grab_weekday_ppp.km
R = 0.31997, p-value &lt; 2.2e-16
alternative hypothesis: clustered (R &lt; 1)</code></pre>
</div>
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">clarkevans.test</span>(central_grab_weekend_ppp.km, <span class="at">correction=</span><span class="st">"none"</span>, <span class="at">clipregion=</span><span class="st">"central_sg_owin"</span>, <span class="at">alternative=</span><span class="fu">c</span>(<span class="st">"clustered"</span>), <span class="at">nsim=</span><span class="dv">99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Clark-Evans test
    No edge correction
    Z-test

data:  central_grab_weekend_ppp.km
R = 0.4366, p-value &lt; 2.2e-16
alternative hypothesis: clustered (R &lt; 1)</code></pre>
</div>
</div>
<p>From the p-values of the Clark-Evan’s test, we have to conclude that the distributions of the Grab trip origins are clustered in the central planning region of Singapore. A conclusion supported by out KDE plots.</p>
</section>
<section id="limiting-the-road-network-data-to-central-singapore" class="level3">
<h3 class="anchored" data-anchor-id="limiting-the-road-network-data-to-central-singapore">Limiting the Road Network Data to Central Singapore</h3>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>central_roads <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(roads, central_sg)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>central_roads <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(central_roads, <span class="st">"LINESTRING"</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(central_roads, <span class="st">"Data/Geospatial/RDS/central_road_network.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Saving the produced road network for future use …</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>central_roads <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"Data/Geospatial/RDS/central_road_network.rds"</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>central_roads <span class="ot">&lt;-</span> <span class="fu">st_simplify</span>(central_roads, <span class="at">preserveTopology =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>central_road_network_plot <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(central_sg) <span class="sc">+</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"lightyellow"</span>) <span class="sc">+</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Road Network in Central Singapore"</span>) <span class="sc">+</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(central_roads) <span class="sc">+</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"brown"</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_save</span>(central_road_network_plot, <span class="st">"Screenshots/central_road_network.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="Screenshots/central_road_network.png" class="img-fluid"></p>
</section>
<section id="preparing-the-lixel-objects-and-generating-the-line-centre-points" class="level3">
<h3 class="anchored" data-anchor-id="preparing-the-lixel-objects-and-generating-the-line-centre-points">Preparing the lixel objects and generating the line centre points</h3>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>lixels <span class="ot">&lt;-</span> <span class="fu">lixelize_lines</span>(central_roads, <span class="dv">700</span>, <span class="at">mindist =</span> <span class="dv">350</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">lines_center</span>(lixels)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(lixels, <span class="st">"Data/Geospatial/RDS/central_road_lixels.rds"</span>)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(samples, <span class="st">"Data/Geospatial/RDS/central_road_centrepoints.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Saving the produced lixel and centrepoint objects for future use …</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>lixels <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"Data/Geospatial/RDS/central_road_lixels.rds"</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"Data/Geospatial/RDS/central_road_centrepoints.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="performing-the-network-constrained-kernel-density-estimation" class="level3">
<h3 class="anchored" data-anchor-id="performing-the-network-constrained-kernel-density-estimation">Performing the Network Constrained Kernel Density Estimation</h3>
<section id="weekday-data" class="level4">
<h4 class="anchored" data-anchor-id="weekday-data">Weekday Data:</h4>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>weekday_densities <span class="ot">&lt;-</span> <span class="fu">nkde</span>(central_roads, </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">events =</span> central_grab_weekday_sf,  </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(central_grab_weekday_sf)), </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">samples =</span> samples, </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">kernel_name =</span> <span class="st">"gaussian"</span>, </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">bw =</span> <span class="dv">300</span>, </span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">div=</span> <span class="st">"bw"</span>, </span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">method =</span> <span class="st">"simple"</span>, </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">digits =</span> <span class="dv">1</span>, </span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">tol =</span> <span class="dv">1</span>, </span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">grid_shape =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), </span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">max_depth =</span> <span class="dv">8</span>, </span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">agg =</span> <span class="dv">5</span>, </span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sparse =</span> <span class="cn">TRUE</span>, </span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(weekday_densities, <span class="st">"Data/Geospatial/RDS/Grab_weekday_nkde.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>weekday_densities <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"Data/Geospatial/RDS/Grab_weekday_nkde.rds"</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span>density <span class="ot">&lt;-</span> weekday_densities <span class="sc">*</span> <span class="dv">1000</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>lixels<span class="sc">$</span>density <span class="ot">&lt;-</span> weekday_densities <span class="sc">*</span> <span class="dv">1000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="visualising-the-network-constrained-kernel-density-estimate-of-the-weekday-grab-data-over-an-interactive-openstreetmap-layer" class="level4">
<h4 class="anchored" data-anchor-id="visualising-the-network-constrained-kernel-density-estimate-of-the-weekday-grab-data-over-an-interactive-openstreetmap-layer">Visualising the Network Constrained Kernel Density Estimate of the Weekday Grab Data over an interactive <em>OpenStreetMap</em> layer</h4>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>grab_weekday_interactive <span class="ot">&lt;-</span>  <span class="fu">tm_shape</span>(lixels) <span class="sc">+</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">"density"</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">TRUE</span>, <span class="at">main.title =</span> <span class="st">"Network-Constrained Kernel Density Estimation of Grab Call Origins in the CBD"</span>) <span class="sc">+</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(central_grab_weekday_sf) <span class="sc">+</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"green"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>() <span class="sc">+</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_basemap</span>(<span class="st">"OpenStreetMap"</span>)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>grab_weekday_interactive <span class="ot">&lt;-</span> <span class="fu">tmap_leaflet</span>(grab_weekday_interactive)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="fu">saveWidget</span>(grab_weekday_interactive, <span class="st">"Screenshots/CBD_grab_weekday_interactive.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!--html_preserve-->
<p><iframe src="Screenshots/CBD_grab_weekday_interactive.html" width="600" height="400"> </iframe></p>
<!--html_preserve-->
</section>
<section id="weekend-data" class="level4">
<h4 class="anchored" data-anchor-id="weekend-data">Weekend Data:</h4>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>weekend_densities <span class="ot">&lt;-</span> <span class="fu">nkde</span>(central_roads,</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">events =</span> central_grab_weekend_sf,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(central_grab_weekend_sf)),</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">samples =</span> samples,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">kernel_name =</span> <span class="st">"gaussian"</span>,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">bw =</span> <span class="dv">300</span>,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">div=</span> <span class="st">"bw"</span>,</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">"simple"</span>,</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">digits =</span> <span class="dv">1</span>,</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tol =</span> <span class="dv">1</span>,</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">grid_shape =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max_depth =</span> <span class="dv">8</span>,</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">agg =</span> <span class="dv">5</span>,</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sparse =</span> <span class="cn">TRUE</span>,</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(weekend_densities, <span class="st">"Data/Geospatial/RDS/Grab_weekend_nkde.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>weekend_densities <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"Data/Geospatial/RDS/Grab_weekend_nkde.rds"</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span>density <span class="ot">&lt;-</span> weekend_densities <span class="sc">*</span> <span class="dv">1000</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>lixels<span class="sc">$</span>density <span class="ot">&lt;-</span> weekend_densities <span class="sc">*</span> <span class="dv">1000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="visualising-the-network-constrained-kernel-density-estimate-of-the-weekend-grab-data-over-an-interactive-openstreetmap-layer" class="level4">
<h4 class="anchored" data-anchor-id="visualising-the-network-constrained-kernel-density-estimate-of-the-weekend-grab-data-over-an-interactive-openstreetmap-layer">Visualising the Network Constrained Kernel Density Estimate of the Weekend Grab Data over an interactive <em>OpenStreetMap</em> layer</h4>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>grab_weekend_interactive <span class="ot">&lt;-</span>  <span class="fu">tm_shape</span>(lixels) <span class="sc">+</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">"density"</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(central_grab_weekend_sf) <span class="sc">+</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"green"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>() <span class="sc">+</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_basemap</span>(<span class="st">"OpenStreetMap"</span>)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>grab_weekend_interactive <span class="ot">&lt;-</span> <span class="fu">tmap_leaflet</span>(grab_weekend_interactive)</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="fu">saveWidget</span>(grab_weekend_interactive, <span class="st">"Screenshots/CBD_grab_weekend_interactive.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!--html_preserve-->
<p><iframe src="Screenshots/CBD_grab_weekend_interactive.html" width="600" height="400"> </iframe></p>
<!--html_preserve-->


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>