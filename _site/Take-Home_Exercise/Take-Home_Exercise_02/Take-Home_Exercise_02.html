<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Yung Qi Yang">
<meta name="dcterms.date" content="2024-03-03">

<title>IS415 Course Website - Take-Home Exercise 2: Using Spatial-Temporal Analysis to investigate the distribution of Dengue Fever cases in Tainan City, Taiwan</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415 Course Website</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-On Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../Hands-On_Exercise/Hands-On_Exercise_01/Hands-On_Exercise_01.html">
 <span class="dropdown-text">Hands-On Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Exercise/Hands-On_Exercise_02/Hands-On_Exercise_02.html">
 <span class="dropdown-text">Hands-On Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Exercise/Hands-On_Exercise_03/Hands-On_Exercise_03.html">
 <span class="dropdown-text">Hands-On Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Exercise/Hands-On_Exercise_04/Hands-On_Exercise_04.html">
 <span class="dropdown-text">Hands-On Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Exercise/Hands-On_Exercise_05/Hands-On_Exercise_05.html">
 <span class="dropdown-text">Hands-On Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-On_Exercise/Hands-On_Exercise_06/Hands-On_Exercise_06.html">
 <span class="dropdown-text">Hands-On Exercise 6</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-Class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../In-Class_Exercise/In-Class_Exercise_02/In-Class_Exercise_02.html">
 <span class="dropdown-text">In-Class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Exercise/In-Class_Exercise_03/In-Class_Exercise_03.html">
 <span class="dropdown-text">In-Class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Exercise/In-Class_Exercise_04/In-Class_Exercise_04.html">
 <span class="dropdown-text">In-Class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Exercise/In-Class_Exercise_05/In-Class_Exercise_05.html">
 <span class="dropdown-text">In-Class Exercise 5</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-Home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../Take-Home_Exercise/Take-Home_Exercise_01/Take-Home_Exercise_01.html">
 <span class="dropdown-text">Take-Home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-Home_Exercise/Take-Home_Exercise_02/Take-Home_Exercise_02.html">
 <span class="dropdown-text">Take-Home Exercise 2</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#priming-the-project" id="toc-priming-the-project" class="nav-link active" data-scroll-target="#priming-the-project">Priming the project</a></li>
  <li><a href="#preparing-the-r-environment-for-analysis" id="toc-preparing-the-r-environment-for-analysis" class="nav-link" data-scroll-target="#preparing-the-r-environment-for-analysis">Preparing the R-Environment for analysis</a>
  <ul class="collapse">
  <li><a href="#loading-the-necessary-r-packages" id="toc-loading-the-necessary-r-packages" class="nav-link" data-scroll-target="#loading-the-necessary-r-packages">Loading the necessary R-packages</a></li>
  </ul></li>
  <li><a href="#conducting-data-pre-processing-for-analysis" id="toc-conducting-data-pre-processing-for-analysis" class="nav-link" data-scroll-target="#conducting-data-pre-processing-for-analysis">Conducting data pre-processing for analysis</a>
  <ul class="collapse">
  <li><a href="#importing-the-datasets-of-interest" id="toc-importing-the-datasets-of-interest" class="nav-link" data-scroll-target="#importing-the-datasets-of-interest">Importing the datasets of interest</a></li>
  </ul></li>
  <li><a href="#conducting-global-spatial-auto-correlation-analysis" id="toc-conducting-global-spatial-auto-correlation-analysis" class="nav-link" data-scroll-target="#conducting-global-spatial-auto-correlation-analysis">Conducting Global Spatial Auto-correlation analysis</a></li>
  <li><a href="#conducting-local-spatial-auto-correlation-analysis" id="toc-conducting-local-spatial-auto-correlation-analysis" class="nav-link" data-scroll-target="#conducting-local-spatial-auto-correlation-analysis">Conducting Local Spatial Auto-correlation analysis</a></li>
  <li><a href="#conducting-emerging-hot-spot-analysis" id="toc-conducting-emerging-hot-spot-analysis" class="nav-link" data-scroll-target="#conducting-emerging-hot-spot-analysis">Conducting Emerging Hot-Spot Analysis</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-Home Exercise 2: Using Spatial-Temporal Analysis to investigate the distribution of Dengue Fever cases in Tainan City, Taiwan</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Yung Qi Yang </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 3, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="priming-the-project" class="level2">
<h2 class="anchored" data-anchor-id="priming-the-project">Priming the project</h2>
<p>As mentioned in the project outline, Taiwan has been very successful in containing the spread of Dengue Fever for many years. However, in 2023, especially between the epidemic weeks 31 to 50 (which corresponds to the end of July to the middle of December), Taiwan saw a dramatic spike in Dengue Fever cases. The interest of this report then, is to conduct an analysis into the cause of the outbreak, specifically in Tainan City, Taiwan, from a spatial autocorrelation perspective.</p>
</section>
<section id="preparing-the-r-environment-for-analysis" class="level2">
<h2 class="anchored" data-anchor-id="preparing-the-r-environment-for-analysis">Preparing the R-Environment for analysis</h2>
<section id="loading-the-necessary-r-packages" class="level3">
<h3 class="anchored" data-anchor-id="loading-the-necessary-r-packages">Loading the necessary R-packages</h3>
<p>To do so, we will need the following R-packages:</p>
<ul>
<li><strong>sf:</strong> Allows us to handle both spatial data, i.e.&nbsp;the Tainan map data and XY coordinates within the dengue dataset.</li>
<li><strong>sfdep:</strong> Allows us to run spatial autocorrelation statistical analysis of our data.</li>
<li><strong>Kendall:</strong> Used to run the Mann-Kendall’s test in emerging hotspot analysis</li>
<li><strong>tmap:</strong> For visualisation of the spatial data.</li>
<li><strong>tidyverse:</strong> To allow us to investigate, manipulate and write the datasets of interest in a readable manner. Also has great compatibility with <em>sf</em> objects.</li>
<li><strong>lubridate:</strong> To handle time format data and conversion of other data types into time formats.</li>
<li><strong>ggplot2:</strong> Used to visualise data in forms like histograms and line graphs.</li>
<li><strong>htmlwidgets:</strong> Used to save interactive spatial data visualisations as HTML widgets to lessen the burden on Quarto when rendering.</li>
</ul>
<p>The <em>p_load()</em> functionfrom the pacman package is used to load the libraries and automatically install them for the user if they aren’t already installed.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, sfdep, Kendall, tmap, tidyverse, lubridate, ggplot2, htmlwidgets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="conducting-data-pre-processing-for-analysis" class="level2">
<h2 class="anchored" data-anchor-id="conducting-data-pre-processing-for-analysis">Conducting data pre-processing for analysis</h2>
<p>There are 2 datasets of interest to us in this report, the <em>Tainan</em> spatial data, and the <em>dengue_daily</em> aspatial data. The <em>Tainan</em> dataset contains spatial polygon information about the geographical boundaries of Tainan City, whilst the <em>dengue_daily</em> dataset is a record of all reported instances of dengue fever in Taiwan from 1998 till 2023.</p>
<section id="importing-the-datasets-of-interest" class="level3">
<h3 class="anchored" data-anchor-id="importing-the-datasets-of-interest">Importing the datasets of interest</h3>
<section id="tainan-spatial-data" class="level4">
<h4 class="anchored" data-anchor-id="tainan-spatial-data">Tainan Spatial Data:</h4>
<p>To import the Tainan dataset, we require the the <em>st_read()</em> function from the <em>sf</em> package so as to preserve its spatial features. Additionally, <em>st_transform()</em> is required in order to cast the data set into the WGS84 coordinate reference system as the data is originally in TWD97, the Taiwanese <em>CRS</em>. We need to do so in order to visualise the data later on upon <em>OpenStreetMap</em> later as <em>OpenStreetMap</em> is coded in WGS84. From the <em>glimpse()</em> of the data, we can see that we were successful in doing so.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>tainan <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"Data/Geospatial"</span>, <span class="at">layer =</span> <span class="st">"TAINAN_VILLAGE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `TAINAN_VILLAGE' from data source 
  `C:\Users\yungq\Desktop\SMU Modules\Y4S1\Geospatial Analysis and Applications\IS415 Course Website\Take-Home_Exercise\Take-Home_Exercise_02\Data\Geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 649 features and 10 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 120.0269 ymin: 22.88751 xmax: 120.6563 ymax: 23.41374
Geodetic CRS:  TWD97</code></pre>
</div>
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tainan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   VILLCODE          COUNTYNAME          TOWNNAME           VILLNAME        
 Length:649         Length:649         Length:649         Length:649        
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
   VILLENG            COUNTYID          COUNTYCODE           TOWNID         
 Length:649         Length:649         Length:649         Length:649        
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
   TOWNCODE             NOTE                    geometry  
 Length:649         Length:649         POLYGON      :649  
 Class :character   Class :character   epsg:4326    :  0  
 Mode  :character   Mode  :character   +proj=long...:  0  </code></pre>
</div>
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(tainan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 649
Columns: 11
$ VILLCODE   &lt;chr&gt; "67000280002", "67000350032", "67000150009", "67000150010",…
$ COUNTYNAME &lt;chr&gt; "臺南市", "臺南市", "臺南市", "臺南市", "臺南市", "臺南市",…
$ TOWNNAME   &lt;chr&gt; "歸仁區", "安南區", "七股區", "七股區", "七股區", "七股區",…
$ VILLNAME   &lt;chr&gt; "六甲里", "青草里", "溪南里", "七股里", "龍山里", "中寮里",…
$ VILLENG    &lt;chr&gt; "Liujia Vil.", "Qingcao Vil.", "Xinan Vil.", "Qigu Vil.", "…
$ COUNTYID   &lt;chr&gt; "D", "D", "D", "D", "D", "D", "D", "D", "D", "D", "D", "D",…
$ COUNTYCODE &lt;chr&gt; "67000", "67000", "67000", "67000", "67000", "67000", "6700…
$ TOWNID     &lt;chr&gt; "D33", "D06", "D22", "D22", "D22", "D22", "D22", "D22", "D2…
$ TOWNCODE   &lt;chr&gt; "67000280", "67000350", "67000150", "67000150", "67000150",…
$ NOTE       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ geometry   &lt;POLYGON [°]&gt; POLYGON ((120.2725 22.95868..., POLYGON ((120.1176 …</code></pre>
</div>
</div>
<p>Plotting the Tainan geospatial data with tmap’s tm_polygons() function for a quick visualisation (and confirmation of the data):</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(tainan) <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">border.col =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Map of Tainan, Taiwan"</span>, <span class="at">main.title.size =</span> <span class="fl">0.9</span>, <span class="at">main.title.position =</span> <span class="st">"center"</span>, <span class="at">bg.color =</span> <span class="st">"lightblue"</span>) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"rose"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">width =</span> <span class="fl">0.2</span>, )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Exercise_02_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="daily-dengue-report-data" class="level4">
<h4 class="anchored" data-anchor-id="daily-dengue-report-data">Daily Dengue report data:</h4>
<p>Next, we will import the <em>dengue_daily</em> dataset, which is in <em>csv</em> (comma-separated values) format. We will rely on the <em>read_csv()</em> function from the <em>readr</em> package which is part of the <em>tidyverse</em> repository to do so. Additionally, we will not need the <em>sf</em> package for now as the spatial information in the dataset is in <em>character</em> format and thus, will not be recognised automatically by <em>st_read()</em> anyways:</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>dengue <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Aspatial/Dengue_Daily.csv"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dengue)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 106,861
Columns: 26
$ 發病日             &lt;date&gt; 1998-01-02, 1998-01-03, 1998-01-13, 1998-01-15, 19…
$ 個案研判日         &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 通報日             &lt;date&gt; 1998-01-07, 1998-01-14, 1998-02-18, 1998-01-23, 19…
$ 性別               &lt;chr&gt; "男", "男", "男", "男", "男", "男", "男", "女", "女…
$ 年齡層             &lt;chr&gt; "40-44", "30-34", "55-59", "35-39", "55-59", "20-24…
$ 居住縣市           &lt;chr&gt; "屏東縣", "屏東縣", "宜蘭縣", "高雄市", "宜蘭縣", "…
$ 居住鄉鎮           &lt;chr&gt; "屏東市", "東港鎮", "宜蘭市", "苓雅區", "五結鄉", "…
$ 居住村里           &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 最小統計區         &lt;chr&gt; "A1320-0136-00", "A1303-0150-00", "A0201-0449-00", …
$ 最小統計區中心點X  &lt;chr&gt; "120.505898941", "120.453657460", "121.751433765", …
$ 最小統計區中心點Y  &lt;chr&gt; "22.464206650", "22.466338948", "24.749214667", "22…
$ 一級統計區         &lt;chr&gt; "A1320-04-008", "A1303-09-007", "A0201-23-006", "A6…
$ 二級統計區         &lt;chr&gt; "A1320-04", "A1303-09", "A0201-23", "A6408-10", "A0…
$ 感染縣市           &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 感染鄉鎮           &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 感染村里           &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 是否境外移入       &lt;chr&gt; "否", "是", "是", "否", "否", "是", "否", "否", "是…
$ 感染國家           &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 確定病例數         &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ 居住村里代碼       &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 感染村里代碼       &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 血清型             &lt;chr&gt; "None", "第二型", "None", "None", "None", "None", "…
$ 內政部居住縣市代碼 &lt;chr&gt; "10013", "10013", "10002", "64", "10002", "68", "65…
$ 內政部居住鄉鎮代碼 &lt;chr&gt; "1001301", "1001303", "1000201", "6400800", "100020…
$ 內政部感染縣市代碼 &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 內政部感染鄉鎮代碼 &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…</code></pre>
</div>
</div>
<p>A quick investigation of the data yields the following:</p>
<ol type="1">
<li>There are missing spatial information in the dataset (some reports do not list reporting coordinates).</li>
<li>It is a medium sized dataset with 106, 861 rows.</li>
</ol>
<p>A quick calculation reveals that there are 1560 rows with missing coordinate information. Considering the overall size of the data, it is reasonable, nor do we have much option anyways, to remove rows with missing spatial information from the dataset as that will have repurcussions on our analysis if we leave them be.</p>
<p>To do so, we rely upon the <em>mutate()</em> and <em>filter()</em> functions from <em>dplyr()</em>, whilst using <em>as.numeric()</em> to convert the coordinates into floating number values so that <em>sf</em> may recognise it. To convert the dataset into a <em>simple features</em> object, we explicitly parse the <em>“最小統計區中心點X”</em> and <em>“最小統計區中心點Y”</em> columns as spatial information, using the <em>st_as_st()</em> function to cast the <em>dataframe</em>, and the <em>st_set_crs()</em> function to specify the use of the <em>WGS84</em> coordinate reference system.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dengue <span class="ot">&lt;-</span> dengue <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(最小統計區中心點<span class="at">X =</span> <span class="fu">as.numeric</span>(最小統計區中心點X),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>         最小統計區中心點<span class="at">Y =</span> <span class="fu">as.numeric</span>(最小統計區中心點Y)) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(最小統計區中心點X) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(最小統計區中心點Y)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"最小統計區中心點X"</span>, <span class="st">"最小統計區中心點Y"</span>), <span class="at">crs =</span> <span class="st">"TWD97"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="dv">4326</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dengue)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     發病日            個案研判日            通報日          
 Min.   :1998-01-02   Length:106081      Min.   :1998-01-07  
 1st Qu.:2014-10-29   Class :character   1st Qu.:2014-11-01  
 Median :2015-09-29   Mode  :character   Median :2015-10-01  
 Mean   :2016-04-09                      Mean   :2016-04-12  
 3rd Qu.:2023-07-02                      3rd Qu.:2023-07-05  
 Max.   :2024-01-29                      Max.   :2024-01-29  
     性別              年齡層            居住縣市           居住鄉鎮        
 Length:106081      Length:106081      Length:106081      Length:106081     
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
   居住村里          最小統計區         一級統計區         二級統計區       
 Length:106081      Length:106081      Length:106081      Length:106081     
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
   感染縣市           感染鄉鎮           感染村里         是否境外移入      
 Length:106081      Length:106081      Length:106081      Length:106081     
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
   感染國家           確定病例數 居住村里代碼       感染村里代碼      
 Length:106081      Min.   :1    Length:106081      Length:106081     
 Class :character   1st Qu.:1    Class :character   Class :character  
 Mode  :character   Median :1    Mode  :character   Mode  :character  
                    Mean   :1                                         
                    3rd Qu.:1                                         
                    Max.   :2                                         
    血清型          內政部居住縣市代碼 內政部居住鄉鎮代碼 內政部感染縣市代碼
 Length:106081      Length:106081      Length:106081      Length:106081     
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
 內政部感染鄉鎮代碼          geometry     
 Length:106081      POINT        :106081  
 Class :character   epsg:4326    :     0  
 Mode  :character   +proj=long...:     0  
                                          
                                          
                                          </code></pre>
</div>
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dengue)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 106,081
Columns: 25
$ 發病日             &lt;date&gt; 1998-01-02, 1998-01-03, 1998-01-13, 1998-01-15, 19…
$ 個案研判日         &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 通報日             &lt;date&gt; 1998-01-07, 1998-01-14, 1998-02-18, 1998-01-23, 19…
$ 性別               &lt;chr&gt; "男", "男", "男", "男", "男", "男", "女", "女", "男…
$ 年齡層             &lt;chr&gt; "40-44", "30-34", "55-59", "35-39", "55-59", "40-44…
$ 居住縣市           &lt;chr&gt; "屏東縣", "屏東縣", "宜蘭縣", "高雄市", "宜蘭縣", "…
$ 居住鄉鎮           &lt;chr&gt; "屏東市", "東港鎮", "宜蘭市", "苓雅區", "五結鄉", "…
$ 居住村里           &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 最小統計區         &lt;chr&gt; "A1320-0136-00", "A1303-0150-00", "A0201-0449-00", …
$ 一級統計區         &lt;chr&gt; "A1320-04-008", "A1303-09-007", "A0201-23-006", "A6…
$ 二級統計區         &lt;chr&gt; "A1320-04", "A1303-09", "A0201-23", "A6408-10", "A0…
$ 感染縣市           &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 感染鄉鎮           &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 感染村里           &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 是否境外移入       &lt;chr&gt; "否", "是", "是", "否", "否", "否", "否", "是", "是…
$ 感染國家           &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 確定病例數         &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ 居住村里代碼       &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 感染村里代碼       &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 血清型             &lt;chr&gt; "None", "第二型", "None", "None", "None", "None", "…
$ 內政部居住縣市代碼 &lt;chr&gt; "10013", "10013", "10002", "64", "10002", "65", "63…
$ 內政部居住鄉鎮代碼 &lt;chr&gt; "1001301", "1001303", "1000201", "6400800", "100020…
$ 內政部感染縣市代碼 &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ 內政部感染鄉鎮代碼 &lt;chr&gt; "None", "None", "None", "None", "None", "None", "No…
$ geometry           &lt;POINT [°]&gt; POINT (120.5059 22.46421), POINT (120.4537 22…</code></pre>
</div>
</div>
<p>As the dengue information covers the whole of Taiwan, the <em>st_intersection()</em> function is used to confine the spread of the data solely to Tainan, our project objective. <em>st_union()</em> is applied here to draw the outer boundaries of Tainan, and speed up the computation time.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dengue <span class="ot">&lt;-</span> dengue <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersection</span>(<span class="fu">st_union</span>(tainan))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>dengue <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_rds</span>(<span class="st">"Data/RDS/dengue_tainan.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A visualisation of the locations of dengue fever reports in Tainan is as follows:</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(tainan) <span class="sc">+</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">border.col =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Outbreak of Dengue Fever in Tainan, Taiwan"</span>, <span class="at">main.title.size =</span> <span class="fl">0.9</span>, <span class="at">main.title.position =</span> <span class="st">"center"</span>, <span class="at">bg.color =</span> <span class="st">"lightblue"</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dengue) <span class="sc">+</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">size =</span> <span class="fl">0.05</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"rose"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Exercise_02_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the incident map drawn, we can see that the majority of dengue fever reports occur in the south-western part of the city which explains why a further restriction of the data to a couple of towns within Tainan was specified as part of the report. Below, we will constrict the <em>Tainan</em> spatial polygon data to the requested towns using the <em>filter()</em> function from <em>dpylr</em>, and produce an easy visualisation of the new area of focus.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tainan <span class="ot">&lt;-</span> tainan <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TOWNID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"D01"</span>, <span class="st">"D02"</span>, <span class="st">"D04"</span>, <span class="st">"D06"</span>, <span class="st">"D07"</span>, <span class="st">"D08"</span>, <span class="st">"D32"</span>, <span class="st">"D39"</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(tainan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 258
Columns: 11
$ VILLCODE   &lt;chr&gt; "67000350032", "67000270011", "67000370005", "67000330004",…
$ COUNTYNAME &lt;chr&gt; "臺南市", "臺南市", "臺南市", "臺南市", "臺南市", "臺南市",…
$ TOWNNAME   &lt;chr&gt; "安南區", "仁德區", "中西區", "南區", "安南區", "安南區", "…
$ VILLNAME   &lt;chr&gt; "青草里", "保安里", "赤嵌里", "大成里", "城北里", "城南里",…
$ VILLENG    &lt;chr&gt; "Qingcao Vil.", "Bao'an Vil.", "Chihkan Vil.", "Dacheng Vil…
$ COUNTYID   &lt;chr&gt; "D", "D", "D", "D", "D", "D", "D", "D", "D", "D", "D", "D",…
$ COUNTYCODE &lt;chr&gt; "67000", "67000", "67000", "67000", "67000", "67000", "6700…
$ TOWNID     &lt;chr&gt; "D06", "D32", "D08", "D02", "D06", "D06", "D08", "D06", "D0…
$ TOWNCODE   &lt;chr&gt; "67000350", "67000270", "67000370", "67000330", "67000350",…
$ NOTE       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ geometry   &lt;POLYGON [°]&gt; POLYGON ((120.1176 23.08387..., POLYGON ((120.2304 …</code></pre>
</div>
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(tainan) <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">border.col =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Outbreak Region of Tainan, Taiwan"</span>, <span class="at">main.title.size =</span> <span class="fl">0.9</span>, <span class="at">main.title.position =</span> <span class="st">"center"</span>, <span class="at">bg.color =</span> <span class="st">"lightblue"</span>) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"rose"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Exercise_02_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As the boundary of the reports have been re-drawn, we will need to employ the <em>st_intersection()</em> function once again to restrict the dengue reports to the focus area:</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dengue <span class="ot">&lt;-</span> dengue <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersection</span>(<span class="fu">st_union</span>(tainan))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>By plotting the newly restricted <em>daily_dengue</em> data over the <em>Tainan</em> data subset, we can confirm that the restriction process has gone well:</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(tainan) <span class="sc">+</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">border.col =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Cases of Dengue Fever in Tainan, Taiwan"</span>, <span class="at">main.title.size =</span> <span class="fl">0.9</span>, <span class="at">main.title.position =</span> <span class="st">"center"</span>, <span class="at">bg.color =</span> <span class="st">"lightblue"</span>) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dengue) <span class="sc">+</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">size =</span> <span class="fl">0.05</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"rose"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">+</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Exercise_02_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, we will need to reduce the dengue report data that we have to the time period which we are interested in, namely the 31<sup>st</sup> to 50<sup>th</sup> epidemic weeks of 2023. To do so, we first need to extract out the year and week information from the data. Thus, we apply the <em>year()</em> and <em>isoweek()</em> functions from the <em>lubridate</em> package to do so, and the <em>mutate()</em> function from <em>dplyr</em> to create these new columns in the data.</p>
<p>There are 3 functions to extract the week information from a <em>date</em> field in <em>lubridate</em>, but we will use <em>isoweek()</em> for the following reason. In order to conduct year-on-year analysis of the data, we will need a way to standardise the weeks extracted across the years. <em>weeks()</em> will not allow us to do so, whereas <em>isoweek()</em> will. Of course as we are not doing year-on-year analysis, choosing <em>isoweek()</em> will not make an impactful difference, but it still is good practice to do so. <em>epiweek()</em> is discounted on the other hand, as even though it standardises week extraction, it starts the week on a Sunday rather than a Monday as is standard in Taiwan.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dengue <span class="ot">&lt;-</span> dengue <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(發病年 <span class="ot">=</span> <span class="fu">year</span>(發病日), 發病周 <span class="ot">=</span> <span class="fu">isoweek</span>(發病日)) </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>dengue <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(發病周) <span class="sc">%&gt;%</span> </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">dengue_count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> dengue_count, <span class="at">x =</span> 發病周)) <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">col =</span> <span class="st">"orange"</span>, <span class="at">scale_colour_hue =</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Trend of Dengue Fever Cases in Tainan, Taiwan"</span>) <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Epidemic Week"</span>) <span class="sc">+</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Number of Dengue Cases Reported"</span>) <span class="sc">+</span> </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"navy"</span>), </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.1</span>),</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Exercise_02_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Using <em>ggplot2</em> this time, we visualise above, the trend of dengue reports across our area of focus in Taiwan over 2023 on a weekly basis. From our graph, it becomes evident that the dengue reports does pick up dramatically from weeks 31 to 50 as the project outline states. Thus, we employ the <em>filter()</em> function once again to narrow down our study scope.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dengue <span class="ot">&lt;-</span> dengue <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(發病年 <span class="sc">==</span> <span class="dv">2023</span> <span class="sc">&amp;</span> (<span class="fu">between</span>(發病周, <span class="dv">31</span>, <span class="dv">50</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>dengue <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_rds</span>(<span class="st">"Data/RDS/dengue_tainan_wk31_50.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A visualisation of the base of our study using <em>tmap</em> is thus, as follows:</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(tainan) <span class="sc">+</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">border.col =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Cases of Dengue Fever between epidemic weeks 31 to 50 in Tainan, Taiwan"</span>, <span class="at">main.title.size =</span> <span class="fl">0.75</span>, <span class="at">main.title.position =</span> <span class="st">"center"</span>, <span class="at">bg.color =</span> <span class="st">"lightblue"</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dengue) <span class="sc">+</span> </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">size =</span> <span class="fl">0.05</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">"rose"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Exercise_02_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="conducting-global-spatial-auto-correlation-analysis" class="level2">
<h2 class="anchored" data-anchor-id="conducting-global-spatial-auto-correlation-analysis">Conducting Global Spatial Auto-correlation analysis</h2>
<p>To conduct our global spatial autocorrelation analysis, we will employ <strong>Moran’s I</strong> statistics rather than <strong>Geary’s C</strong> as transmission of dengue occurs via the Aedes vector, and we should not lighten the impact of linear associations of dengue reports from our analysis.</p>
<p>To start, we need to count the number of reports which occurred in each polygon of our geographical scope. The <em>st_intersects()</em> function is employed over the <em>st_intersection()</em> function here for computation speed as we need not retain all information in the data, only just the counts. <em>lengths()</em> is used to compute the length of each element in the list generated by <em>st_intersects()</em>.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>tainan<span class="sc">$</span>dengue_count <span class="ot">&lt;-</span> tainan <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(dengue) <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lengths</span>()</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(tainan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 258
Columns: 12
$ VILLCODE     &lt;chr&gt; "67000350032", "67000270011", "67000370005", "67000330004…
$ COUNTYNAME   &lt;chr&gt; "臺南市", "臺南市", "臺南市", "臺南市", "臺南市", "臺南市…
$ TOWNNAME     &lt;chr&gt; "安南區", "仁德區", "中西區", "南區", "安南區", "安南區",…
$ VILLNAME     &lt;chr&gt; "青草里", "保安里", "赤嵌里", "大成里", "城北里", "城南里…
$ VILLENG      &lt;chr&gt; "Qingcao Vil.", "Bao'an Vil.", "Chihkan Vil.", "Dacheng V…
$ COUNTYID     &lt;chr&gt; "D", "D", "D", "D", "D", "D", "D", "D", "D", "D", "D", "D…
$ COUNTYCODE   &lt;chr&gt; "67000", "67000", "67000", "67000", "67000", "67000", "67…
$ TOWNID       &lt;chr&gt; "D06", "D32", "D08", "D02", "D06", "D06", "D08", "D06", "…
$ TOWNCODE     &lt;chr&gt; "67000350", "67000270", "67000370", "67000330", "67000350…
$ NOTE         &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ geometry     &lt;POLYGON [°]&gt; POLYGON ((120.1176 23.08387..., POLYGON ((120.230…
$ dengue_count &lt;int&gt; 2, 19, 111, 29, 1, 10, 38, 44, 112, 65, 28, 2, 3, 11, 24,…</code></pre>
</div>
</div>
<p>Next, we need to compute the congruity weight matrix as <strong>Moran’s I</strong> is a congruity based method. The <em>st_contiguity()</em> is used to do so, with the <em>queen</em> option set to true as mentioned prior, the vector-transmission method of dengue fever does not allow us to discount neither the neighbours at the edge nor vertices. The <em>st_weights()</em> function is used to compute the weights of each polygon in the dataset, with <em>style</em> set to ‘W’ so that row-standardised weights are computed.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>weight_matrix_queen <span class="ot">&lt;-</span> tainan <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">neighbours =</span> <span class="fu">st_contiguity</span>(geometry, <span class="at">queen =</span> <span class="cn">TRUE</span>),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight =</span> <span class="fu">st_weights</span>(neighbours, <span class="at">style =</span> <span class="st">"W"</span>),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> <span class="dv">1</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(weight_matrix_queen<span class="sc">$</span>neighbours)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 258 
Number of nonzero links: 1526 
Percentage nonzero weights: 2.29253 
Average number of links: 5.914729 
Link number distribution:

 2  3  4  5  6  7  8  9 10 11 12 14 
 4 17 47 49 49 41 26 14  6  3  1  1 
4 least connected regions:
77 117 138 238 with 2 links
1 most connected region:
128 with 14 links</code></pre>
</div>
</div>
<p>After we obtain the row-standardised weight matrix of our spatial data, we can proceed to compute the global Moran’s statistic with it. <em>global_moran_perm()</em> is used to conduct a Monte-Carlo simulation of the <strong>global Moran’s I</strong> statistic with 500 simulations done. As in all <strong>Monte-Carlo</strong> simulations conducted in this report, 500 simulations will be used as it represents the largest amount of simulations my computer can conduct in a reasonable amount of time.</p>
<p>Additionally, <em>set.seed()</em> is used to ensure that the results of the simulation are repeatable.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3142</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>global_moran_500 <span class="ot">&lt;-</span> <span class="fu">global_moran_perm</span>(weight_matrix_queen<span class="sc">$</span>dengue_count, </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                  weight_matrix_queen<span class="sc">$</span>neighbours,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                  weight_matrix_queen<span class="sc">$</span>weight,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nsim =</span> <span class="dv">499</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(global_moran_500)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  x 
weights: listw  
number of simulations + 1: 500 

statistic = 0.46821, observed rank = 500, p-value &lt; 2.2e-16
alternative hypothesis: two.sided</code></pre>
</div>
</div>
<p>From the simulation results, we can see that the p-value is extremely low, leading to a conclusion that the incidents of dengue cases in Tainan show evidence of non-randomness at all reasonable levels of statistical significance. This result is not surprising as Aedes mosquitoes breed and travel short ranges, meaning that when they start carrying the Dengue virus, we expect people near to the initial carrier of dengue to suffer from it to. Also, we might think from the perspective that areas where Aedes mosquitoes thrive will frequently give rise to clusters of dengue cases as they are more prone to breeding of mosquitoes which makes it difficult to eliminate the vector in these areas.</p>
<p>We can visualise the Monte-Carlo simulation using <em>geom_histogram()</em> and <em>geom_vline()</em> from ggplot2 as below:</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(global_moran_500<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">499</span>]),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">bins =</span> <span class="dv">100</span>, </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"blue"</span>, </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha =</span> <span class="fl">0.7</span>, </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span> </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(global_moran_500<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">499</span>]), </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monte-Carlo Simulation of Global Moran's I test-statistic (n = 500)"</span>) <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Global Moran's I test-statistic"</span>) <span class="sc">+</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Exercise_02_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="conducting-local-spatial-auto-correlation-analysis" class="level2">
<h2 class="anchored" data-anchor-id="conducting-local-spatial-auto-correlation-analysis">Conducting Local Spatial Auto-correlation analysis</h2>
<p>For the same reasons as in the global spatial auto-correlation analysis, Moran’s I statistic will be used over Geary’s C here.</p>
<p>Like in our global spatial auto-correlation analysis, we will need a congruity weight matrix first as Moran’s I is a congruity-based method. Luckily, there is no obvious reason to compute a different congruity weight matrix and thus we will used the one generated in our global spatial auto-correlation analysis.</p>
<p>To apply the local Moran’s I test, the <em>local_moran()</em> function is used and simulated over 500 times. As the result of the <em>local_moran()</em> function is a nested list, <em>unnest()</em> is thus, needed to expand it into a readable format.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>lisa <span class="ot">&lt;-</span> weight_matrix_queen <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">local_moran =</span> <span class="fu">local_moran</span>(weight_matrix_queen<span class="sc">$</span>dengue_count, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                  weight_matrix_queen<span class="sc">$</span>neighbours,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                  weight_matrix_queen<span class="sc">$</span>weight,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nsim =</span> <span class="dv">499</span>),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(local_moran)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>An interactive display of the Moran’s I statistic is shown below:</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>lisa_leaflet <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(lisa) <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"ii"</span>, </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Moran's I"</span>, </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">interactive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_basemap</span>(<span class="st">"OpenStreetMap"</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>lisa_leaflet <span class="ot">&lt;-</span> <span class="fu">tmap_leaflet</span>(lisa_leaflet)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="fu">saveWidget</span>(lisa_leaflet, <span class="st">"Screenshots/lisa_leaflet.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!--html_preserve-->
<iframe src="Screenshots/lisa_leaflet.html" width="650" height="400">
</iframe>
<!--html_preserve-->
<p>An interactive display of the p-values of the Moran’s I statistic is shown below:</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>lisa_p_leaflet <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(lisa) <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"p_ii_sim"</span>, </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Moran's I p-value"</span>, </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">interactive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_basemap</span>(<span class="st">"OpenStreetMap"</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>lisa_p_leaflet <span class="ot">&lt;-</span> <span class="fu">tmap_leaflet</span>(lisa_p_leaflet)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="fu">saveWidget</span>(lisa_p_leaflet, <span class="st">"Screenshots/lisa_p_leaflet.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!--html_preserve-->
<iframe src="Screenshots/lisa_p_leaflet.html" width="650" height="400">
</iframe>
<!--html_preserve-->
<p>An interactive display of the regions with a significant Moran’s I statistic (5% level) is shown below:</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>lisa_sig_leaflet <span class="ot">&lt;-</span> lisa <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(<span class="at">filter =</span> .<span class="sc">$</span>p_ii <span class="sc">&lt;=</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_fill</span>(<span class="st">"mean"</span>, </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> <span class="st">"Local Moran's I clusters"</span>, </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">interactive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_basemap</span>(<span class="st">"OpenStreetMap"</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>lisa_sig_leaflet <span class="ot">&lt;-</span> <span class="fu">tmap_leaflet</span>(lisa_sig_leaflet)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="fu">saveWidget</span>(lisa_sig_leaflet, <span class="st">"Screenshots/lisa_sig_leaflet.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!--html_preserve-->
<iframe src="Screenshots/lisa_sig_leaflet.html" width="650" height="400">
</iframe>
<!--html_preserve-->
</section>
<section id="conducting-emerging-hot-spot-analysis" class="level2">
<h2 class="anchored" data-anchor-id="conducting-emerging-hot-spot-analysis">Conducting Emerging Hot-Spot Analysis</h2>
<p>Beyond spatial auto-correlation analysis, we should also be interested in spatio-temporal analysis as the intensity of the outbreak over time will determine how easy is it to contain it. To do so, we will need to create a <em>spacetime_cube</em> object using the <em>spacetime()</em> function in <em>sfdep</em>.</p>
<p>However, before we can proceed to do so, we will need to create a dataframe of all possible combinations of spatio-temporal events across our dataset. This is done via the following code:</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>spatial_temporal_dengue_count <span class="ot">&lt;-</span> <span class="fu">crossing</span>(dengue<span class="sc">$</span>發病周, </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>         tainan<span class="sc">$</span>VILLCODE) <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"WEEK"</span> <span class="ot">=</span> <span class="st">"dengue$發病周"</span>, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">"VILLCODE"</span> <span class="ot">=</span> <span class="st">"tainan$VILLCODE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tainan, <span class="at">by =</span> <span class="st">"VILLCODE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"WEEK"</span>, <span class="st">"VILLCODE"</span>, <span class="st">"geometry"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="st">"WGS84"</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>spatial_temporal_dengue_count<span class="sc">$</span>DENGUE_COUNT <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">31</span><span class="sc">:</span><span class="dv">50</span>) {</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  spatial_temporal_dengue_count[spatial_temporal_dengue_count<span class="sc">$</span>WEEK <span class="sc">==</span> t, <span class="st">"DENGUE_COUNT"</span>] <span class="ot">&lt;-</span> </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_intersects</span>(</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>      spatial_temporal_dengue_count <span class="sc">%&gt;%</span> </span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(WEEK <span class="sc">==</span> t), </span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>      dengue <span class="sc">%&gt;%</span> </span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(發病周 <span class="sc">==</span> t)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lengths</span>()</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>spatial_temporal_dengue_count <span class="ot">&lt;-</span> spatial_temporal_dengue_count <span class="sc">%&gt;%</span> </span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(spatial_temporal_dengue_count)</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(spatial_temporal_dengue_count<span class="sc">$</span>DENGUE_COUNT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>crossing()</em> is used to create a dataframe of all possible weeks over all spatial regions in Tainan, resulting in a total of 5160 combinations. After which, <em>st_intersects()</em> and <em>filter()</em> are employed iteratively, to give a count of the number of dengue reports in each region over each time period.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>spatial_temporal_dengue_count <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_rds</span>(<span class="st">"Data/RDS/spatial_temporal_dengue_count.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-true="false">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5,160
Columns: 3
$ WEEK         &lt;dbl&gt; 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 3…
$ VILLCODE     &lt;chr&gt; "67000270001", "67000270002", "67000270003", "67000270004…
$ DENGUE_COUNT &lt;int&gt; 0, 0, 1, 4, 2, 0, 1, 0, 1, 7, 1, 2, 0, 0, 0, 0, 42, 0, 0,…</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 18800</code></pre>
</div>
</div>
<p>A <em>sum()</em> of our counts column matches up with the total number of cases in our reduced <em>dengue_daily</em> data.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>dengue_spt <span class="ot">&lt;-</span> <span class="fu">spacetime</span>(<span class="at">.data =</span> spatial_temporal_dengue_count, </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.geometry =</span> tainan,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.loc_col =</span> <span class="st">"VILLCODE"</span>, </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.time_col =</span> <span class="st">"WEEK"</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">is_spacetime_cube</span>(dengue_spt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>And <em>is_spacetime_cube()</em> confirms that we were successful. Thus, we can proceed to conduct the emerging hot-spot analysis using our spacetime cube, upon the <em>DENGUE_COUNT</em> feature which we created in the earlier step. The analysis is performed using the <em>emerging_hotspot_analysis()</em> function from <em>sfdep</em>, which utilises both Gerd-Ord’s Gi* statistic and Mann-Kendall statistic to do so. Thus, <em>Kendall</em> needs to be installed in the R-Environment as earlier.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>ehsa <span class="ot">&lt;-</span> <span class="fu">emerging_hotspot_analysis</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> dengue_spt, </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.var =</span> <span class="st">"DENGUE_COUNT"</span>, </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">1</span>, </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">499</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(ehsa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>ehsa <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_rds</span>(<span class="st">"Data/RDS/dengue_ehsa.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 258
Columns: 4
$ location       &lt;chr&gt; "67000350032", "67000270011", "67000370005", "670003300…
$ tau            &lt;dbl&gt; 0.37894735, 0.36842102, 0.56842101, 0.41052628, 0.54736…
$ p_value        &lt;dbl&gt; 2.124822e-02, 2.517831e-02, 5.174875e-04, 1.248217e-02,…
$ classification &lt;chr&gt; "oscilating coldspot", "oscilating coldspot", "consecut…</code></pre>
</div>
</div>
<p>Using <em>ggplot2</em>, we can visualise the frequency of each type of hot-spot identified in our emerging hot-spot analysis Monte-Carlo simulation.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ehsa,</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> classification)) <span class="sc">+</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"orange"</span>) <span class="sc">+</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Types of Hot-Spots Identified"</span>) <span class="sc">+</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Classification"</span>) <span class="sc">+</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Number of hot-spots"</span>) <span class="sc">+</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">10</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.7</span>),</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"lightgrey"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Exercise_02_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>And using <em>tmap</em>, we can display an interactive map of the different hot-spots over <em>OpenStreetMap</em>.</p>
<div class="cell">
<details class="code-fold">
<summary>Reveal Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>ehsa_leaflet <span class="ot">&lt;-</span> tainan <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ehsa,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(VILLCODE <span class="sc">==</span> location)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(<span class="at">filter =</span> .<span class="sc">$</span>p_value <span class="sc">&lt;=</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_fill</span>(<span class="st">"classification"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">interactive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.3</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> <span class="st">"Classification"</span>) <span class="sc">+</span> </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_basemap</span>(<span class="st">"OpenStreetMap"</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>ehsa_leaflet <span class="ot">&lt;-</span> <span class="fu">tmap_leaflet</span>(ehsa_leaflet)</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="fu">saveWidget</span>(ehsa_leaflet, <span class="st">"Screenshots/ehsa_leaflet.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!--html_preserve-->
<iframe src="Screenshots/ehsa_leaflet.html" width="650" height="400">
</iframe>
<!--html_preserve-->
<p>From the interactive map produced, we can see that most of the hot-spots are oscillating hot and cold spots, and are also mostly centered around the central parts of our map scope. There is actually quite an intuitive explanation. The proximity and human density of the hot/cold spots are probably really high considering their location, which will only make it easier for Dengue Fever to spread. Additionally, public facilities like pipes and drains are likely to be under higher stress, making it easier for Aedes mosquitoes to breed. Thus, it is likely that these areas will be most prone to dengue outbreaks and it is a testament to Taiwan’s dengue management that they are oscillation spots, because this mostly likely happens as they are able to contain outbreaks but not fast enough to stop the spread to other regions.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>